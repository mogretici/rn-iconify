# Performance Monitoring

Monitor and optimize icon loading performance in your app with built-in metrics collection.

## Enable Metrics

Enable performance monitoring in development:

```tsx copy
import { enableMetrics, getMetrics } from 'rn-iconify';

// Enable metrics collection
enableMetrics(true);

// Later, retrieve metrics
const metrics = getMetrics();
console.log(metrics);
```

## Metrics Data

The metrics object contains:

```tsx
interface IconMetrics {
  // Total icons loaded
  totalLoaded: number;

  // Icons loaded from cache
  cacheHits: number;

  // Icons fetched from network
  networkFetches: number;

  // Average load time (ms)
  averageLoadTime: number;

  // Failed loads
  failures: number;

  // Cache hit rate (0-1)
  cacheHitRate: number;

  // Per-icon timing data
  iconTimings: Map<string, number>;
}
```

## Usage Example

```tsx copy
import { useEffect } from 'react';
import { enableMetrics, getMetrics, resetMetrics } from 'rn-iconify';

function App() {
  useEffect(() => {
    // Enable in development only
    if (__DEV__) {
      enableMetrics(true);
    }

    // Log metrics periodically
    const interval = setInterval(() => {
      const metrics = getMetrics();
      console.log('Icon Performance:', {
        loaded: metrics.totalLoaded,
        cacheHitRate: `${(metrics.cacheHitRate * 100).toFixed(1)}%`,
        avgLoadTime: `${metrics.averageLoadTime.toFixed(0)}ms`,
        failures: metrics.failures,
      });
    }, 10000);

    return () => clearInterval(interval);
  }, []);

  return <MainApp />;
}
```

## Debug Component

Create a debug overlay for development:

```tsx copy
import { useState, useEffect } from 'react';
import { View, Text, StyleSheet } from 'react-native';
import { enableMetrics, getMetrics } from 'rn-iconify';

function IconDebugOverlay() {
  const [metrics, setMetrics] = useState(getMetrics());

  useEffect(() => {
    enableMetrics(true);

    const interval = setInterval(() => {
      setMetrics(getMetrics());
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  if (!__DEV__) return null;

  return (
    <View style={styles.overlay}>
      <Text style={styles.title}>Icon Metrics</Text>
      <Text style={styles.metric}>
        Loaded: {metrics.totalLoaded}
      </Text>
      <Text style={styles.metric}>
        Cache: {(metrics.cacheHitRate * 100).toFixed(0)}%
      </Text>
      <Text style={styles.metric}>
        Avg: {metrics.averageLoadTime.toFixed(0)}ms
      </Text>
      <Text style={styles.metric}>
        Errors: {metrics.failures}
      </Text>
    </View>
  );
}

const styles = StyleSheet.create({
  overlay: {
    position: 'absolute',
    top: 50,
    right: 10,
    backgroundColor: 'rgba(0,0,0,0.8)',
    padding: 10,
    borderRadius: 8,
    zIndex: 9999,
  },
  title: {
    color: 'white',
    fontWeight: 'bold',
    marginBottom: 5,
  },
  metric: {
    color: 'white',
    fontSize: 12,
  },
});
```

## Bundle Analyzer

Analyze which icons are bundled (when using Babel plugin):

```tsx copy
import { getBundledIcons, getBundleStats } from 'rn-iconify';

// List all bundled icons
const bundled = getBundledIcons();
console.log('Bundled icons:', bundled);

// Get bundle statistics
const stats = getBundleStats();
console.log('Bundle stats:', {
  totalIcons: stats.count,
  sizeKB: (stats.sizeBytes / 1024).toFixed(2),
  iconSets: stats.sets,
});
```

## Identify Slow Icons

Find icons that are slow to load:

```tsx copy
import { getMetrics } from 'rn-iconify';

function analyzeSlowIcons() {
  const metrics = getMetrics();
  const slowIcons = [];

  metrics.iconTimings.forEach((time, icon) => {
    if (time > 500) { // > 500ms
      slowIcons.push({ icon, time });
    }
  });

  if (slowIcons.length > 0) {
    console.warn('Slow loading icons:', slowIcons);
  }

  return slowIcons;
}
```

## Optimization Recommendations

Based on metrics, optimize your icon usage:

### High Network Fetches

If `networkFetches` is high, consider:

```tsx copy
import { prefetchIcons } from 'rn-iconify';

// Prefetch commonly used icons at app start
async function initApp() {
  await prefetchIcons([
    'mdi:home',
    'mdi:settings',
    'mdi:account',
    // ... frequently used icons
  ]);
}
```

### Low Cache Hit Rate

If `cacheHitRate` is low:

1. **Check cache configuration**:
```tsx copy
import { configureCache } from 'rn-iconify';

configureCache({
  maxSize: 1000, // Increase max cached icons
  ttl: 86400000 * 30, // 30 days TTL
});
```

2. **Use Babel plugin** for critical icons:
```js
// babel.config.js
module.exports = {
  plugins: [
    ['rn-iconify/babel', {
      icons: ['mdi:home', 'mdi:settings'],
    }],
  ],
};
```

### High Average Load Time

If `averageLoadTime` is high:

1. **Use local Iconify server**:
```tsx copy
import { setIconifyServer } from 'rn-iconify';

setIconifyServer('http://localhost:3000');
```

2. **Bundle critical icons**:
```js
// babel.config.js
module.exports = {
  plugins: [
    ['rn-iconify/babel', {
      icons: ['mdi:*'], // Bundle all MDI icons
    }],
  ],
};
```

### Failures

If `failures` is non-zero:

```tsx copy
import { getMetrics, onIconError } from 'rn-iconify';

// Listen for icon errors
onIconError((error, iconName) => {
  console.error(`Failed to load icon: ${iconName}`, error);

  // Report to error tracking
  Sentry.captureException(error, {
    tags: { icon: iconName },
  });
});
```

## Production Monitoring

For production apps, integrate with your analytics:

```tsx copy
import { enableMetrics, getMetrics } from 'rn-iconify';
import analytics from '@segment/analytics-react-native';

function setupIconAnalytics() {
  enableMetrics(true);

  // Report metrics periodically
  setInterval(() => {
    const metrics = getMetrics();

    analytics.track('Icon Performance', {
      totalLoaded: metrics.totalLoaded,
      cacheHitRate: metrics.cacheHitRate,
      averageLoadTime: metrics.averageLoadTime,
      failures: metrics.failures,
    });
  }, 60000); // Every minute
}
```

## Reset Metrics

Clear metrics for fresh measurement:

```tsx copy
import { resetMetrics, getMetrics } from 'rn-iconify';

// Reset all metrics
resetMetrics();

// Metrics are now zeroed
const metrics = getMetrics();
console.log(metrics.totalLoaded); // 0
```

## Performance Targets

Recommended targets for good icon performance:

| Metric | Target | Action if Poor |
|--------|--------|----------------|
| Cache Hit Rate | > 90% | Increase cache size, prefetch icons |
| Avg Load Time | < 100ms | Use local server, bundle critical icons |
| Failures | 0 | Check network, validate icon names |

## Best Practices

### 1. Development Only

```tsx
if (__DEV__) {
  enableMetrics(true);
}
```

### 2. Regular Monitoring

```tsx
useEffect(() => {
  const interval = setInterval(() => {
    const metrics = getMetrics();
    // Analyze and log
  }, 5000);

  return () => clearInterval(interval);
}, []);
```

### 3. Set Performance Budget

```tsx
function checkIconBudget() {
  const metrics = getMetrics();

  if (metrics.averageLoadTime > 200) {
    console.warn('Icon load time exceeds budget');
  }

  if (metrics.cacheHitRate < 0.8) {
    console.warn('Cache hit rate below target');
  }
}
```

## Next Steps

- [Babel Plugin](/advanced/babel-plugin) - Bundle icons for 0ms load
- [Architecture](/advanced/architecture) - Understanding the caching system
- [Custom Server](/advanced/custom-server) - Self-hosted Iconify server
