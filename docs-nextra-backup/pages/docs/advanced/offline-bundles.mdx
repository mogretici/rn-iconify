# Offline Bundles

Create and load icon bundles for complete offline support without any network requests.

import { Callout } from 'nextra/components'

## When to Use Offline Bundles

- **Air-gapped environments**: No network access
- **Guaranteed availability**: Critical icons always available
- **Reduced latency**: Zero network delay
- **Compliance**: Strict network policies

## Creating Bundles

### CLI Method

Generate a bundle using the CLI:

```bash copy
npx rn-iconify generate \
  --icons "mdi:home,mdi:settings,heroicons:user" \
  --format json \
  --output ./src/icons/bundle.json
```

### Programmatic Method

```tsx copy
import { createBundle } from 'rn-iconify';

async function generateBundle() {
  const bundle = await createBundle([
    'mdi:home',
    'mdi:settings',
    'mdi:account',
    'heroicons:user',
    'heroicons:cog',
  ]);

  // Save to file
  const fs = require('fs');
  fs.writeFileSync(
    './src/icons/bundle.json',
    JSON.stringify(bundle)
  );
}
```

## Loading Bundles

Load the bundle at app startup:

```tsx copy
import { loadOfflineBundle } from 'rn-iconify';
import iconBundle from './icons/bundle.json';

// Load before rendering any icons
loadOfflineBundle(iconBundle);

function App() {
  return (
    <>
      <Mdi name="home" />  {/* Loads instantly from bundle */}
      <Mdi name="settings" />
    </>
  );
}
```

## Bundle Format

The bundle JSON structure:

```json
{
  "version": 1,
  "generated": "2024-01-15T10:30:00Z",
  "icons": {
    "mdi:home": {
      "body": "<path d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\"/>",
      "width": 24,
      "height": 24
    },
    "mdi:settings": {
      "body": "<path d=\"...\"/>",
      "width": 24,
      "height": 24
    }
  }
}
```

## Bundle by Icon Set

Create separate bundles per icon set:

```bash copy
# Material Design Icons
npx rn-iconify generate --icons "mdi:*" --output ./bundles/mdi.json

# Heroicons
npx rn-iconify generate --icons "heroicons:*" --output ./bundles/heroicons.json
```

Load specific bundles:

```tsx copy
import mdiBundle from './bundles/mdi.json';
import heroiconsBundle from './bundles/heroicons.json';

// Load only what you need
loadOfflineBundle(mdiBundle);
loadOfflineBundle(heroiconsBundle);
```

## Lazy Loading Bundles

Load bundles on demand:

```tsx copy
import { loadOfflineBundle } from 'rn-iconify';

async function loadIconSet(setName: string) {
  let bundle;

  switch (setName) {
    case 'mdi':
      bundle = await import('./bundles/mdi.json');
      break;
    case 'heroicons':
      bundle = await import('./bundles/heroicons.json');
      break;
  }

  if (bundle) {
    loadOfflineBundle(bundle);
  }
}

// Load when entering a screen that uses specific icons
useEffect(() => {
  loadIconSet('heroicons');
}, []);
```

## Bundle Optimization

### Analyze Usage First

```bash copy
# See which icons you actually use
npx rn-iconify analyze --src ./src

# Generate bundle with only used icons
npx rn-iconify generate \
  --icons "mdi:home,mdi:settings,mdi:account" \
  --output ./bundle.json
```

### Size Comparison

| Bundle Content | Approximate Size |
|----------------|------------------|
| 10 icons | ~5 KB |
| 100 icons | ~50 KB |
| 500 icons | ~250 KB |
| Full MDI (7,447) | ~3.5 MB |

<Callout type="warning">
  Only bundle icons you actually use. Analyze your codebase first with `npx rn-iconify analyze`.
</Callout>

## Hybrid Mode

Combine offline bundles with runtime fetching:

```tsx copy
import { loadOfflineBundle, configureIconify } from 'rn-iconify';
import criticalIcons from './bundles/critical.json';

// Load critical icons from bundle
loadOfflineBundle(criticalIcons);

// Configure fallback to network for non-bundled icons
configureIconify({
  fallbackToNetwork: true,
  networkTimeout: 5000,
});
```

## Versioning Bundles

Include version info in your bundles:

```tsx copy
import { loadOfflineBundle, getBundleVersion } from 'rn-iconify';
import iconBundle from './bundle.json';

// Check bundle version
const currentVersion = getBundleVersion();
const bundleVersion = iconBundle.version;

if (bundleVersion > currentVersion) {
  loadOfflineBundle(iconBundle);
  console.log(`Updated icon bundle to v${bundleVersion}`);
}
```

## OTA Bundle Updates

Update bundles without app store releases:

```tsx copy
import { loadOfflineBundle } from 'rn-iconify';
import AsyncStorage from '@react-native-async-storage/async-storage';

async function updateIconBundle() {
  try {
    // Fetch latest bundle from your server
    const response = await fetch('https://your-server.com/icons/bundle.json');
    const bundle = await response.json();

    // Save for offline use
    await AsyncStorage.setItem('iconBundle', JSON.stringify(bundle));

    // Load immediately
    loadOfflineBundle(bundle);
  } catch (error) {
    // Fall back to stored bundle
    const stored = await AsyncStorage.getItem('iconBundle');
    if (stored) {
      loadOfflineBundle(JSON.parse(stored));
    }
  }
}
```

## Build Integration

### Webpack

```js copy
// webpack.config.js
const IconifyPlugin = require('rn-iconify/webpack');

module.exports = {
  plugins: [
    new IconifyPlugin({
      icons: ['mdi:home', 'mdi:settings'],
      output: 'icons.json',
    }),
  ],
};
```

### Metro

```js copy
// metro.config.js
const { withIconifyBundle } = require('rn-iconify/metro');

module.exports = withIconifyBundle({
  icons: ['mdi:home', 'mdi:settings'],
});
```

## TypeScript Support

Generate TypeScript definitions for your bundle:

```bash copy
npx rn-iconify generate \
  --icons "mdi:home,mdi:settings" \
  --format ts \
  --output ./src/icons/bundle.ts
```

Generated file:

```tsx
// bundle.ts
export const iconBundle = {
  "mdi:home": { ... },
  "mdi:settings": { ... },
} as const;

export type BundledIconName = keyof typeof iconBundle;
```

## Validation

Validate bundle integrity:

```tsx copy
import { validateBundle } from 'rn-iconify';
import iconBundle from './bundle.json';

const validation = validateBundle(iconBundle);

if (!validation.valid) {
  console.error('Invalid bundle:', validation.errors);
}

console.log(`Bundle contains ${validation.iconCount} icons`);
```

## Best Practices

### 1. Bundle Critical Icons

```tsx copy
// Critical icons - always bundled
const criticalIcons = [
  'mdi:home',
  'mdi:menu',
  'mdi:close',
  'mdi:arrow-left',
];
```

### 2. Keep Bundles Small

```bash
# Bad - bundles everything
npx rn-iconify generate --icons "mdi:*"

# Good - bundles only what's used
npx rn-iconify generate --icons "mdi:home,mdi:settings,mdi:user"
```

### 3. Update Bundles Regularly

```json
// package.json
{
  "scripts": {
    "icons:bundle": "rn-iconify generate --icons \"mdi:home,mdi:settings\" --output ./src/icons/bundle.json",
    "prebuild": "npm run icons:bundle"
  }
}
```

## Troubleshooting

### Bundle Not Loading

```tsx copy
import { isBundleLoaded, getBundledIcons } from 'rn-iconify';

console.log('Bundle loaded:', isBundleLoaded());
console.log('Bundled icons:', getBundledIcons());
```

### Icon Not in Bundle

```tsx copy
import { isIconBundled } from 'rn-iconify';

if (!isIconBundled('mdi:home')) {
  console.warn('mdi:home not in bundle, will fetch from network');
}
```

## Next Steps

- [Babel Plugin](/advanced/babel-plugin) - Build-time bundling alternative
- [Custom Server](/advanced/custom-server) - Self-hosted icon server
- [Architecture](/advanced/architecture) - How bundling works
